/*! For license information please see 88261.0fa1f06a.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[88261],{88261:(e,s,n)=>{n.r(s),n.d(s,{default:()=>I});var t=n(65043),a=n(78626),r=n(46100),i=n(36011),o=n(12524),l=n(6051),c=n(95206),d=n(97606),g=n(57721),h=n(53727),m=n(58168);const v={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var u=n(22172),p=function(e,s){return t.createElement(u.A,(0,m.A)({},e,{ref:s,icon:v}))};const x=t.forwardRef(p);var y=n(63390),f=n(67407),C=n(70579);const j=e=>{let{index:s}=e;const{currentMessages:n,currentConversationId:m,addMessageToConversation:v,setIsStreaming:u,setConversations:p,streamingConversations:j,addStreamingConversation:b,setStreamedContentMap:A,removeStreamingConversation:w}=(0,a.v)(),[k,z]=(0,t.useState)(!1),[I,S]=(0,t.useState)(n[s].content),{checkedKeys:M}=(0,i.X)(),{TextArea:R}=o.A;return(0,C.jsx)("div",{children:k?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(R,{style:{width:"38vw",height:"100px"},value:I,onChange:e=>S(e.target.value)}),(0,C.jsxs)(l.A,{style:{marginTop:"8px"},children:[(0,C.jsx)(c.Ay,{icon:(0,C.jsx)(h.A,{}),onClick:()=>{z(!1),S(n[s].content)},size:"small",children:"Cancel"}),(0,C.jsx)(c.Ay,{icon:(0,C.jsx)(x,{}),onClick:()=>{p(e=>e.map(e=>{if(e.id===m){const n=e.messages.map((e,n)=>n===s?{...e,content:I,_timestamp:Date.now()}:e);return{...e,messages:n,_version:Date.now()}}return e})),z(!1)},size:"small",children:"Save"}),(0,C.jsx)(c.Ay,{icon:(0,C.jsx)(y.A,{}),onClick:async()=>{z(!1),A(new Map);const e=n.slice(0,s+1);e[s]={...e[s],content:I,_timestamp:Date.now()},p(s=>s.map(s=>s.id===m?{...s,messages:e}:s)),b(m);try{const e=await(0,r.f)(m,I,j.has(m),n,A,u,(0,g.F)(M),v,w);if(e){v({content:e,role:"assistant"},m)}}catch(t){console.error("Error sending message:",t),w(m)}finally{u(!1)}},size:"small",type:"primary",children:"Submit"})]})]}):(0,C.jsx)(d.A,{title:"Edit",children:(0,C.jsx)(c.Ay,{icon:(0,C.jsx)(f.A,{}),onClick:()=>{z(!0)}})})})};var b=n(91686);const A={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"};var w=function(e,s){return t.createElement(u.A,(0,m.A)({},e,{ref:s,icon:A}))};const k=t.forwardRef(w),z=t.lazy(()=>Promise.all([n.e(53653),n.e(79218),n.e(96603),n.e(2785),n.e(46907),n.e(18884)]).then(n.bind(n,46907))),I=(0,t.memo)(e=>{let{enableCodeApply:s}=e;const{currentMessages:n,isTopToBottom:o,isLoadingConversation:l,addStreamingConversation:h,streamingConversations:m,currentConversationId:v,setIsStreaming:u,setStreamedContentMap:p,addMessageToConversation:x,removeStreamingConversation:y}=(0,a.v)(),{checkedKeys:f}=(0,i.X)(),A=(0,t.useRef)(!0),w=o?n:[...n].reverse(),I=(0,t.useRef)(0);(0,t.useEffect)(()=>{console.debug("Conversation messages updated:",{messageCount:n.length,previousCount:I.current,isVisible:A.current,displayOrder:o?"top-down":"bottom-up"}),n.length!==I.current&&(I.current=n.length,console.log(`Rendered ${n.length} messages`));const e=new IntersectionObserver(e=>{e.forEach(e=>{A.current=e.isIntersecting,console.debug("Conversation visibility changed:",{isVisible:e.isIntersecting,messageCount:n.length})})},{threshold:.1});return()=>e.disconnect()},[n.length]);const S=l?n.length>0?`Loading messages (${n.length} loaded)...`:"Loading conversation...":"",M=l&&n.length>0,R=l&&0===n.length,V=e=>(e=>{const s=n[e],t=e===n.length-1,a=e+1,r=a<n.length?n[a]:null,i=a<n.length;return"human"===(null===s||void 0===s?void 0:s.role)&&!m.has(v)&&(t||i&&"assistant"!==(null===r||void 0===r?void 0:r.role))})(e)?(0,C.jsx)(d.A,{title:"The AI response may have failed. Click to retry.",children:(0,C.jsx)(c.Ay,{icon:(0,C.jsx)(k,{}),type:"primary",size:"small",onClick:async()=>{const s=n[e];h(v);try{await(0,r.f)(v,s.content,m.has(v),n,p,u,(0,g.F)(f),x,y)}catch(t){y(v),console.error("Error retrying message:",t)}},children:"Retry AI Response"})}):null;return(0,C.jsxs)("div",{style:{position:"relative"},children:[R&&(0,C.jsx)("div",{style:{position:"fixed",top:"var(--header-height)",left:"var(--folder-panel-width)",right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,C.jsx)(b.A,{size:"large",tip:S})}),(0,C.jsxs)("div",{style:{opacity:l?.5:1,minHeight:"50px"},className:"conversation-messages-container",children:[M&&(0,C.jsxs)("div",{style:{position:"sticky",top:0,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"8px 16px",borderRadius:"4px",margin:"8px 0",display:"flex",alignItems:"center",gap:"8px",zIndex:1e3},children:[(0,C.jsx)(b.A,{size:"small"}),(0,C.jsx)("span",{children:S})]}),w.map((e,a)=>{w.length;const r=o?a:n.length-1-a,i=r+1,l=i<n.length,c=l?n[i]:null,d="human"===e.role&&!m.has(v)&&(r===n.length-1||l&&"assistant"!==(null===c||void 0===c?void 0:c.role));return(0,C.jsxs)("div",{className:`message ${e.role}${d?" needs-response":""}`,children:["human"===e.role?(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,C.jsx)("div",{className:"message-sender",children:"You:"}),(0,C.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[d&&V(r),(0,C.jsx)(j,{index:o?a:n.length-1-a})]})]}):(0,C.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,C.jsx)("div",{className:"message-sender",children:"AI:"}),V(r)]}),(0,C.jsx)("div",{className:"message-content",children:(0,C.jsx)(t.Suspense,{fallback:(0,C.jsx)("div",{children:"Loading content..."}),children:(0,C.jsx)(z,{markdown:e.content,enableCodeApply:s})})})]},a)})]})]})})}}]);
//# sourceMappingURL=88261.0fa1f06a.chunk.js.map